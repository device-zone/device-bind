#!/bin/bash

if test "$1" = "start"; then

  if test -f "/etc/device/system/dns/resolver/protocol.txt"; then
    protocol="$(head -n 1 /etc/device/system/dns/resolver/protocol.txt)"
    if test "${protocol}" == "all"; then
      OPTIONS=""
    elif test "${protocol}" == "ipv4-only"; then
      OPTIONS="-4"
    elif test "${protocol}" == "ipv6-only"; then
      OPTIONS="-6"
    fi
  fi

  cat >> "named" <<- EOF
# Generated by $0 on `date`
# DO NOT MODIFY THIS FILE - it will be overwritten on server restart.
#

NAMEDCONF=/etc/named/named-device.conf
OPTIONS="${OPTIONS}"
EOF

  install -m 644 "named" "/etc/sysconfig/named"

fi

